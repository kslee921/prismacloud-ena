
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: twistlock-view
rules:
- apiGroups: ["rbac.authorization.k8s.io"]
  resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"] # Allow Defenders to list RBAC resources
  verbs: ["list"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"] # Allow Defenders to get Deployments and ReplicaSets
  verbs: ["get"]
- apiGroups: [""] # Core API
  resources: ["namespaces", "pods"] # Allow Defenders to get Namespaces and Pods
  verbs: ["get"]
---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: twistlock-view-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: twistlock-view
subjects:
- apiGroup:
  kind: ServiceAccount
  name: twistlock-service
  namespace: twistlock
---

---
apiVersion: v1
kind: Secret
metadata:
  name: twistlock-secrets
  namespace: twistlock
type: Opaque
data:
  service-parameter: clR6SzF3ZytIL1lBYk85K1hzY0c1SmNkTjRmRHFSWXphMitvS20ybVNyMzhEY1ZTN3Q4engzTVRBMzZFYWNTZXJZdzBzUVlXL3RwbkNLVVRTS29sYlE9PQ==
  defender-ca.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIRENDQWdTZ0F3SUJBZ0lRRzM0eFJQU2lDS0tEY0tNYXFwNXpLakFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TWpBeQpNamN3T0RNeE1EQmFGdzB5TlRBeU1qWXdPRE14TURCYU1DZ3hFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekVTCk1CQUdBMVVFQXhNSlZIZHBjM1JzYjJOck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQXZSSzZoZEZoYksvR3NTTmpCNFJ4YkhrWFkrWUFjVEs4bm9JdUM0bFNSRjhjem8wamFCMmd4d00zTGUycQpoTGNIaW9nblZmMGpUVGtFSDVlWnBzbFhpek5LWXdXbFZrQ2VuK1JXU0F4bVFacDVtZTA0Q3ZWUHVSWm5jT2duCm9mcnlZRHcyS3NXa1FwUEdDNjJnejZqSmdnYkFaUVNsZ2ZWV2FJLzdrd3FmVjl3WVd5SGJoaC9ya0VTcDg0dy8KUWxsYU4vWHg5VHJ6S3JyN25hVGpoSmg1WDFFZUFUS01GQW9vTXc0Y0w0SEtlTkdWejd5eGZCY0FJY1R1Z2c3MApVcEVSd2c1VlpJVTBKeFZRVys2ZW9CZkc4MWYrTmx4TVMzMGpuTFB0V1NwZU1GU3dZOElXQ1VLajJUem91WlE4ClRhbERUMzFjd2ZGVzRlNUtESDg3RWZCSUhRSURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQXF3d0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVVyVlFGQ1c3WENMdjA5RS9NRU8ybEhwM2tmYWt3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLd2NnZFRWa1k1bWRCSHU3dUhRc09JV1hNT2ozb205Sm8vWllYaEM0NDlFCkZCT3VQWHZJMzNORjNUdjRNL2JqckpWbngzMGhRc2pqVXIwUFVYam5zYkNhSHhXejAvVzgrZXFCMnBtTjU3VFUKUCtKdlNRdDJ0QXpEUHliREtlenlpUHNBd2VBcE91Y1M3cHhHaFpWWU1qbGlvOGNJTG53WG5Fa3FxT1Zpc1FDMwpNK3hnZHI0ano0VW9aL1pSYStuZXVaeVhPdXpwdUxPb0UwRjZ5R0hBUS8yZGR3eFBWeU0vVzBZWEFVenFBMTA0Cmh4RGJCeHplWHNJejZlTkJReWg3aEUySmRvUjNnLzF5ekZidkFydmtHNVoreUdCRk01ZWNyKzN4SUVSZ3VmWjIKR2M5TXJXb0pFb3UrOGU5a1dGU25HM0o1UklyejhIS3NGT2pPZVZ4cFRQQT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  defender-client-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPekNDQWlPZ0F3SUJBZ0lRSG9zcDV6eUNaODlTRUFlSFN1NkVRREFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TkRBNApNVE15TXpVMU1EQmFGdzB5TnpBNE1UTXlNelUxTURCYU1DZ3hFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekVTCk1CQUdBMVVFQXhNSmJHOWpZV3hvYjNOME1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQXQrbWZtcEVONTRpWlBPeC9RYlNCMWFMMFA0R0RpWG8vNU1OZGxVaTR6eE1wY1V4ODNJVXFRTzNCNVlkTgprN2JyamkwMUhMM3lBNVZhaUtVN2dYWGx6aEZKZ1MySFhUVFN4bFA0QVYxa0hIOVE2QVg1NnpWcVN6cXVXT2N2CkdrTDlmMlBRL1pIYWF5clJUS0t4anFLY0xvd1hnQ3VoREZySXZxb0VQQ1BKZTU1M0hIanFIK3BYQ2NlQnB3ZXEKKzYyaUZwUm92Nyt4dHE5UC9SQmhNdFZYR0xZQnZOKzFpWVQzSmVScjFRUXZzRFdmMkVFRWV0cUQzSXVnMWpvUwpYSGRpdVFhRjBuM3A2Q2lnTHZ2aVdGMnZlR3F4ZjdLSjVweTZLMXJFUk9DRXQxaHBtb0xpN1dOR1JOc1RBRDBJCjZYblc2Z3pzNmFWZmJ2dDQyT211bjdVVjNRSURBUUFCbzJFd1h6QU9CZ05WSFE4QkFmOEVCQU1DQjRBd0V3WUQKVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3REFZRFZSMFRBUUgvQkFJd0FEQWZCZ05WSFNNRUdEQVdnQlN0VkFVSgpidGNJdS9UMFQ4d1E3YVVlbmVSOXFUQUpCZ1VxQkFFQ0J3UUFNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUFQCllXWlQvL3lmN1gxN0JvMTNaYXJ2WDdaeEk2Y3hSRFhSV0FxTHBxcm0rSHlETFFKRHgveldBUGsvV2FGOWhDR1oKWXpIblBzaFNEL3R3cUgwMlNNMWs5SmxxcGZRcnd1QVdQK29HUUZtNzBva3J6NUhwY1ViTkMxVkRNWlRxaWZSeQpOejFLNlE1dkZrSkZmdDd3SjIyaGg5T1ZQb3lFS3RXTlBaWWlpN0ZuMzlsZ1FvSDFpMG5QeXNVb3B4aFVaNEF4Cm5jRjg0NCtpVlBtVSs4Y3JTaDBlaXhDYXlDc0k3cVM4TzR3Y3Zha29sUjJJSjN0NEZmWTBrajlRUWE2WE54YnEKK3ZyQnZuMEJ4TW9BTGFZVmJTN1NNSzJYTVEvbVlieW52NlpTYllUV0dzc3lDQjdkTFNPUXRJdmw5K3JVZmpYOQp6TGYzSmNWY3NNdFNEamF0WjMzaQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  defender-client-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQywzNjViNjAzMzk3NWViMTgwOTZlYTZlY2JjNmJhYjhkNAoKOXVmMVNDbXhTU0RURUllbDRkbHZhUUJQV3hpY2NpTFYrOTZ3RzdyWXNscG1KTjZaTTQzSHJOM0w5Vjd4WEVEagp0VlpQb1FOcFR1RzNKOUlpeUVoK0d0UFZOMFEvSWlCZVMrbk1heWtkb3I4eDNFN0lVVXRrYVFSSVRSMHBmb1ErClN0T1hTUTdGSGZlZERUVEg3Yk91Y3ZadzJvd0hNNFZmaVI4UmRxYUg1RkhCWGYyL2dzZHM4MnpUUDZqZnhkTnAKV1htTm9Dajl5WmpOcWMrc0pxRFB0clg5Sy84VGdVVUFwcTdJaDhEV0M1NUlydnpwVmdJM0ZYMmt6S0c5aGQ2OApxdzZXVWtuaVBjODRRYjM5eDE4d2tKcFZsZkVCdkZmZG80UGd4UTQ3Z016a2dCT3JHbTNCS2VjUnJGeUF3S05pClRyajVvVHJYMnZFeWdidjZrNGJySmFkQlJZaEQ4Z0wvekJYYVJndWVUN1ducis1QkIvblJYcTlsTFZzNjJ3RzQKMXVEY0tBNlNqRVNTL08vZWVvZkUyOWJBUHExOWpsK2lnQ0E4QkM1QyttU2doQ2s3RDBIaUxhZlgrVERBb2dDMgpuNThKVVl1SzJBZGRJRW5iOHNjS1VYZGdPQUltVWxKRzMvdU5pNGNObklxRHV2c1Q4ZmtCUkpEQ0ZTalRJZllFCjZOcjNQTUNBM1JpbU1nSVZKbnhXRldpS3dKMnF0VmM1WjQ1Q1FHZ25CTEFaSzRGc1FvZHBQRVBvcXRpc2U3U0QKd0dDMmhHMnF5TUpmZlBZcVRsTGNNQWdKMWtBd2pyRXlkOVhyUjBEMjhRTlowMjVVYTcyVHZuK3JwTkQzWDNESwp2SEMrVDdFbTlmSDd3WjFzemlQdTE3M05vL2s4TTJ0R0t5UE9oQlFxUkNNa2hiK1Ird1Nkb1YvckZPRHhLdHlQCkg2bTZ6dXJWdnNka0pnTzNkUUJnMmlKS000ZTYwQ1pjcTg4SkZXOUpIdk9RN3EzaHBoSlNWZk9QUk0zanN0L3AKNWNybS9naTFzZWVRMzdFaDhSYjU0cHFzTGUwb2dROUFIb3lEYlBCeTgxeis5UElFckJIc0oyQkM5bjFyZzVJcQpWZ1V3VU9leU1zUnUxalp1MG4wY05TU2hKUlROS3NaRERYZTB0ZzlUK2k3U1RXTk4vL05CZjZGRExubHpzZ2NzCkRKaURlS202ZEUxWkNtSTEyWDRzY2ZJaS9EallUSGQyZ2l3QUIzdDR6ZVdaTElmeURpZkR2d1Y0ZFJweE90OGsKSkkwN2JRYmhUdGtLL0F2c0hVYXdqNGdQdUFzYkM1V2NqZStKSnc2NWpRcjNDWVpHeWJ5Qm5wMlFpS1VNVjZkbwpTVXFWZEdobW52WjFCQUFrWFpvRjZ1bEhhWmpKVVRIZ3FCODV3RE05eHFGMGtKSEhveUtGTy9RMFFrN0Jqd3RnCmlaeXZJM1kzbFAzRXovaS9tZXNWdEppaURTL0hoQlZqcytqWkJrRllTcmk2NkcvZWtIamhvT3haY3dFNS8vOGIKeXg4QWM5Q0lNbEhlS25iYXYrb2pRTTdubGRrZjJnVm1VTTRibWtwaytPVDdCRUwvUEpiaXZJMDRWcEI5cytHZwo4c0J6d2VmbnZJaDFqZFNRQ3pBTTBaMFJ0V0N0eU1UWFNlekdrSDI2dVQzM2lLUzM1amJQbmVnY2xSeHRLeFpuCjh3bmc2R1hrM0hzMGk5NmpnL2ZCTmh6OVpFdE5xMWgzdHJwTDBUcWxndkhjRDQ4aU1ybHBVYTFUVm1EL3YranYKK2xNaG5YSEU1Q1Yvd1ljdDAyVEFTa3ZqbldLRjl5enhReXAya29DVWFuVWUycVd1blRjVTlYd2NuZGp0d2ZjVworMFYxTFJLMnpFd0lEV1RSQUZWLzBYajZCUUVZSXVlS1FDZElITEZQTjRFWFFBbWV2R1FOYjl3VFlHbDduZEVGCnIwR0poeFFpakNxOHZBQ3pMN1AyT3NuNG1qdVY0dWNDU0h1YmlRRTVJaVlOM0lJb3NYZjVtdXRHZjUzRmFuM1IKQUFmVngvZWhta1UwKzYwSXZpTmE0c2NuUEcrdnRrMXN6ajlTWDgwS0dyK0pjaVdheERHbGJnTHNjZWdKQkhnYgotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  admission-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURTekNDQWpPZ0F3SUJBZ0lRSHkrS3VOU2laTjA2YzBSYzhYVVFuVEFOQmdrcWhraUc5dzBCQVFzRkFEQW8KTVJJd0VBWURWUVFLRXdsVWQybHpkR3h2WTJzeEVqQVFCZ05WQkFNVENWUjNhWE4wYkc5amF6QWVGdzB5TkRBNQpNRE13T0RVeE1EQmFGdzB5TnpBNU1ETXdPRFV4TURCYU1CUXhFakFRQmdOVkJBb1RDVlIzYVhOMGJHOWphekNDCkFTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBT1NsNUZXK0ZoRnRHTS9TOXJmaU16Mi8KdW15bEt4ZjZhSXNlRlhpNlNtYWNXRGUreTNQWkNqZTNyNUtSb0JXdVJxc3FuQU1mZGE1UTkzY1RtNFpPbU9YWQp4L2RxRDUzdWNxMFpxWWY2bEpSZmVPR2tmcjZwVnJLQUc4VUJGcUxLTklUYitXeFBCYURIUHJiRHRtdWhZS2xNCjlPbmF2dFBqVjMwWk9yemhRSjArTmh2T2hYL0lhdE5ZZUlRL1cvNmE3N2xCdEQ0Ui90OEJvRzBISWFLT3p6dHQKWTRWYkxXME1QUjF5Z1lTVDlDRndMWmQ1WUhGalA5d2ZvVXpTd3ptOU9rbXhHWGNqZldSc3NsV0daUXJSYmVtNQpRK0daRktRd0tVaDdxbnZNU2tIdEpvbWtqeU1XR0Roc3hlQUZSYWozanAwNzcvNmZNUWJSNzBTVFNUK04vbDBDCkF3RUFBYU9CaERDQmdUQU9CZ05WSFE4QkFmOEVCQU1DQTZnd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUcKQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVclZRRkNXN1hDTHYwOUUvTQpFTzJsSHAza2Zha3dJUVlEVlIwUkJCb3dHSUlXWkdWbVpXNWtaWEl1ZEhkcGMzUnNiMk5yTG5OMll6QU5CZ2txCmhraUc5dzBCQVFzRkFBT0NBUUVBb3BrZjVMZlBjTE85aFMwNG5ObFk4blFDREVIbytFYmlXNm05aTBIYlQ2Y08KdHlTb0IzdS9HN2xWbmx2NExFUUdmSmx4SHN4NlZLSVFqUGVuaE5PU1JLYlNMc01Sb3lTSmlpMjdHVnlBTG9BMApteWEyd2UzQitqcTN1VE5CQ0FrUXgrUnQ1ektsaklJVGg0L2xPRi85ZFd2M2ppMVVUM3p0S1EzOG8zdm45bys3CjE0KzFETWh1NTQ1TGJUcWZQaW5SR1VBLzFzTWhNMGMwMklEMzJkUWZ6Mlh6ajJkbnlGU2xBbTdmVmlXMmpMdlYKOGltTWFSTnB0Um03VzQ0UXZMeldFVWE0UVRrREt2ckhGQUlpUTJOZGtCTkIraklEQW05N0tkK0xTdDlNVmRrVQo2bTZWT3EvNHJ4SmNmaEFXNGJRRWhleG9nNGpzMlVHcFpBbUI1RmxXQkE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  admission-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBBRVMtMjU2LUNCQyxiMjRmNTYxMjMwZGQ3ZDQ3MGZmZTZmMzhjNTcyZGZhOQoKa0VCeTVrclMwbWtnQnZWNDExN2FCL3N0eVNTTFB5VGJVOCtFSWtUZS9VMUJVV3Job25EQ0JKV1JNZ2VRZzNHUQpjc1JLWkpxVzQxR3ZtaFlQM0JQTDRnZUpxQ2ljd3pQZ2VNNDloVmJEM1NkOUZxYlRzU3krcXAyRSswWmtZQlRTCmpsT0VsTzFPSXZiYlJwQzJmenVXUGUxekhwSnlBaFp4T1M1Y3FDL2JOYjdNYjNmUlB5S2xvL1ZKcE5oWlB6SFAKRmVFenZ2UmY2TTR4Y0puS2hpVEhuaUVFSEVlWjcrQTRRb1U1Z3BncEg2MlpYN2V3dnViRUFsZzkxUzJKcVV4cwpzcE9iSnZDV1RsZFRSTHN0R3c4MFdaVFp3UzlYZ1ZWTi90MnNvcjNpazhaYlJNbDdiVk5oV1laOTZSM2pwU1NnClp5OTBqNzVBWGd0aVJnWUhvRmdqdXJKbUhWejE0U0RaZ3NrclZ5RXpDdkVkUGRoaDBQMERkMU16TXI0NUIyd1EKaTFxTmYrWHdaT1kyYkRQWXV0Y1VWQ1lrSW1XY0N3a3J4aVBOMVJqRzFZclJDbVJHMEtjMG9yS2xtY0lpRW5lSQpkSC82bDRCQm9kM0xIektXdWlXT01ld0E0eWdORFNRelNYemgxMjNDbG5KQjc4S05iUTB2Y3VsKzYxMXJpRzdVCk1sMDhOR3ZrUXBlcGV6MHhJTmVmTEQwTExDajFoR1g4UTd1OTNFaTFHWVFDL29sWmdWNGJXc3RIUFhlcEwxOFoKS1NWOEhNVTNnVXRqZmV5Si9lcUpzSkNwRjN4elZxOW0xTURYWWY3ZjdRU0NGU3hsYWdxdEJYbUo2QXJOZnVlZApZZFpPSVFpbUNENzU4WDdqbXBvZ2VOQmtEcjJDQzNuV0g2L041NE9DRFFHRWNRMmZOV1psam9MSW53cjA0aVI5CldKak9XdEdVb1RwSUR1Zi9SelcvZE1UUzBKSFk0V0I5R2VFVHF4MkltWHI2UzJ0SGFoaG5PNW1zUU9GZ1hOR24KTytWZWgvbjJubHpmZVgyb1dtWENpZmxZaUdtS2ovSjRBWk1IRDhmN0UzcExJL25OeU40MVdCK09ld0pGTEYxWApXVGd4T1NxQy9MU0l0RWoyS1VYSk9lMzQ2Mi80Q3VXZkU1RG43b2U0VlZrZ0NiTENqWGJmQ29JZzlDUy9Qc0wxCnlzMUt3cmIxQlg2d2RiMTBFYUpob2xuVW9Wb3hKZEdaUkY4blBpQVpYMHF0YUlQS1pvNEZhTnhCbnQ0TGxCYTEKVFF5ZGRNd0RhdDhBZjl1RHNIUW91OWRPd0VHUjdJaENWT2lwcDBWMWViQ2xQMHNhSjhFd3RHYlM1RHpaczlJcwpNU1duY0hqSUZQR3lBVlMzTVNXQnVLYW5mU2hwMGlDZDFxRzhTbzBYODdoTDBoRVJPZXZGUkRQeStCZzM2c2NwCncwQXFNYmJiSFdydHNzakV2REFheUlubll5NVEvNEdPaERkaDJrOHRJOUs1QmlSOURXZm5VaHIycVdlMlg4WHEKZ0pTM2pseVJicldUSWhYZkFxa3M2L0JYUlJZYTNKY3FtT0p2SlNxeXlRQWtpMVhHT2djQmdWWFlnVHRZdmRVTAo5QmRmSldGazgvOEIxdVBheElXenlMak9XclQzcE5OL051TDFKYlhkejI3TVNzdkNNN2FHNlB4QUIrT1pyOWhnCmtKMFdEeGx6OVM2WktMR2xFZmxrSGJEWng5R1BQTmNKZ3VUUitDaUV6anI5QTl5NHNSRjdNVTIwYlBFck1IckgKRHJIb1d6STI0VG9hQmNyNzlZcng2V04xVVU5S1ZQSHdyd0JVeEUyM0duem1lTEpmcDZHMEYzZlNpRlNoN2Jjdgo3UnVCMWZqb3U2ZWRIaDUvVXRQM0VUTzVRNC9uMDlXTW8xK0JiRGpwZlFEOGFud0kveFRQaHROL3BDcUI1aGxnCmZPWmhSVmZ5MXh4UU0vcjNNbVVhRE5kZzFOaUNKWmRWeHZhZUNkeCt4UUU1TDRKNHdlREEvMDBSdVJxbnJic0kKL0lqMzlKYVhneUZWYW0wTTRpRHptVnRKWUFJSzZvV3JvbDhXUFJlZkNBRmlNbnhzcFlRc2xzVlFwN2wydWc1VgotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---
apiVersion: v1
kind: ServiceAccount # Service Account is used for managing security context constraints policies in Openshift (SCC)
metadata:
  name: twistlock-service
  namespace: twistlock
secrets:
- name: twistlock-secrets
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: twistlock-defender-ds
  namespace: twistlock
spec:
  selector:
    matchLabels:
      app: twistlock-defender
  template:
    metadata:
      annotations:
        container.apparmor.security.beta.kubernetes.io/twistlock-defender: unconfined
      labels:
        app: twistlock-defender
    spec:
      serviceAccountName: twistlock-service
      restartPolicy: Always
      containers:
      - name: twistlock-defender
        image: registry-auth.twistlock.com/tw_ubn0x1y1vzah0giijuumlkbxo0zejz60/twistlock/defender:defender_32_07_123
        volumeMounts:
        - name: data-folder
          mountPath: "/var/lib/twistlock"
        - name: certificates # Setting the certificates mount after data-folder since it is nested and was overridden in CRI based GKE cluster
          mountPath: "/var/lib/twistlock/certificates"
        - name: docker-sock-folder
          mountPath: "/var/run"
        - name: passwd
          mountPath: "/etc/passwd"
          readOnly: true
        - name: syslog-socket
          mountPath: "/dev/log"
        - name: cri-data
          mountPath: /var/lib/containerd
        - name: cri-rke2-data
          mountPath: /var/lib/rancher/rke2/agent/containerd
        - name: runc-proxy-sock-folder
          mountPath: "/run"
        env:
        - name: WS_ADDRESS
          value: wss://asia-northeast1.cloud.twistlock.com:443
        - name: DEFENDER_TYPE
          value: cri
        - name: LOG_PROD
          value: "true"
        - name: SYSTEMD_ENABLED
          value: "false"
        - name: DOCKER_CLIENT_ADDRESS
          value: "/var/run/docker.sock"
        - name: DEFENDER_CLUSTER_ID
          value: "67a14395-2e3b-d7ca-d5db-504e80884621"
        - name: DEFENDER_CLUSTER_NAME_RESOLVING_METHOD
          value: "default"
        - name: DEFENDER_CLUSTER
          value: ""
        - name: MONITOR_SERVICE_ACCOUNTS
          value: "true"
        - name: MONITOR_ISTIO
          value: "false"
        - name: COLLECT_POD_LABELS
          value: "true"
        - name: INSTALL_BUNDLE
          value: "eyJzZWNyZXRzIjp7fSwiZ2xvYmFsUHJveHlPcHQiOnsiaHR0cFByb3h5IjoiIiwibm9Qcm94eSI6IiIsImNhIjoiIiwidXNlciI6IiIsInBhc3N3b3JkIjp7ImVuY3J5cHRlZCI6IiJ9fSwiY3VzdG9tZXJJRCI6ImFuei0zMDUyOTMwIiwiYXBpS2V5IjoiU2pRQm5MZ1RjajBlZ2M1VDVuN09reWhIOVEzcGc0bU9GbHNiSjdTaHFKTVFpWmFsM2lTT1RwY3ZORksrSWdFaFpTN253U1B6R2M1OThlNVVvWEFKdUE9PSIsIm1pY3Jvc2VnQ29tcGF0aWJsZSI6ZmFsc2V9"
        - name: HOST_CUSTOM_COMPLIANCE_ENABLED
          value: "true"
        - name: CLOUD_HOSTNAME_ENABLED
          value: "false"
        - name: FIPS_ENABLED
          value: "false"
        securityContext:
          readOnlyRootFilesystem: true
          privileged: false
          capabilities:
            add:
            - NET_ADMIN  # Required for process monitoring
            - NET_RAW    # Required for iptables (CNNF, runtime DNS, WAAS). See: https://bugzilla.redhat.com/show_bug.cgi?id=1895032
            - SYS_ADMIN  # Required for filesystem monitoring
            - SYS_PTRACE # Required for local audit monitoring
            - SYS_CHROOT # Required for changing mount namespace using setns
            - MKNOD      # A capability to create special files using mknod(2), used by docker-less registry scanning
            - SETFCAP    # A capability to set file capabilities, used by docker-less registry scanning
            - IPC_LOCK   # Required for perf events monitoring, allowing to ignore memory lock limits
        resources: # See: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#how-pods-with-resource-requests-are-scheduled
          limits:
            memory: "512Mi"
            cpu: "900m"
          requests:
            cpu: "256m"
      volumes:
      - name: certificates
        secret:
          secretName: twistlock-secrets
          defaultMode: 256
      - name: syslog-socket
        hostPath:
          path: "/dev/log"
      - name: data-folder
        hostPath:
          path: "/var/lib/twistlock"
      - name: passwd
        hostPath:
          path: "/etc/passwd"
      - name: docker-sock-folder
        hostPath:
          path: "/var/run"
      - name: cri-data
        hostPath:
          path: /var/lib/containerd
      - name: cri-rke2-data
        hostPath:
          path: /var/lib/rancher/rke2/agent/containerd
      - name: runc-proxy-sock-folder
        hostPath:
          path: "/run"
      hostPID: true
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
---
apiVersion: v1
kind: Service # Expose the Defender as admission controller. Remark: by default, Defender will not listen on the service port
metadata:
  name: defender
  namespace: twistlock
  labels:
    app: twistlock-defender
spec:
  ports:
  - port: 443
    targetPort: 9998
  selector:
    app: twistlock-defender